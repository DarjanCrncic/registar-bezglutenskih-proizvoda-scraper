<div class="p-6 max-w-lg mx-auto">
  <h2 class="text-2xl font-semibold mb-4 text-center">Registar bezglutenskih proizvoda</h2>

  @if (loading()) {
    <div class="text-gray-500">Učitavanje proizvoda...</div>
  }
  @if (error()) {
    <div class="text-red-600">{{ error() }}</div>
  }

  <div class="flex flex-col items-center gap-4 mt-6">
    <!-- Big scanner button -->
    <button
      (click)="openScanner()"
      class="w-56 h-56 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 text-white flex flex-col items-center justify-center shadow-lg transform hover:scale-105 transition"
      aria-label="Open scanner"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
              d="M3 7h4M3 17h4M17 7h4M17 17h4M7 3v4M17 3v4M7 17v4M17 17v4"/>
      </svg>
      <span class="mt-2 font-medium">Skeniraj Barkod</span>
    </button>


    <!-- Result -->
    @if (lastScanned) {
      <div class="w-full mt-4">
        <div class="text-sm text-gray-500">Zadnje skenirani barkod: <span class="font-medium">{{ lastScanned }}</span>
        </div>

        @if (foundProduct) {
          <div class="mt-3 p-4 border rounded-lg shadow-sm bg-white">
            <div class="flex gap-4 flex-col">
              @if (foundProduct.url) {
                <a [href]="foundProduct.url" target="_blank"
                   class="inline-block mt-3 text-sm text-blue-600">Poveznica na stranicu udruge</a>
              }
              @if (foundProduct.image) {
                <img [src]="foundProduct.image" alt="product image"
                     class="object-cover rounded"/>
              }
              <h3 class="text-lg font-semibold">{{ foundProduct.title }}</h3>
              <div class="text-sm text-gray-600 mt-1" [innerHTML]="foundProduct.short_description"></div>

              @if (foundProduct.details) {
                <div class="mt-3 text-xs text-gray-700">
                  @for (key of (foundProduct.details ? (Object.keys(foundProduct.details)) : []); track key) {
                    @if (!["external_link", "notes"].includes(key)) {
                      <p><strong>{{ key }}:</strong> {{ foundProduct.details[key] }}</p>
                    }
                  }
                  @if (foundProduct.details['external_link']; as externalLink) {
                    <p><strong>Poveznica na stranicu proizvođača:</strong>
                      <a [href]="externalLink" target="_blank"> {{ externalLink }} </a>
                    </p>
                  }
                </div>
              }
            </div>
          </div>
        } @else {
          <div class="mt-3 p-4 rounded border border-dashed border-gray-300 text-gray-600">
            Proizvod nije pronađen u registru
          </div>
        }
      </div>
    }

  </div>
</div>

<!-- Scanner modal (simple overlay) -->
@if (isScannerOpen()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4">
    <div class="bg-white rounded-lg w-full max-w-2xl overflow-hidden">
      <div class="flex items-center justify-between p-3">
        <h3 class="text-lg font-semibold">Skenirajte barkod</h3>
        <button (click)="closeScanner()" class="px-4 py-2 rounded bg-gray-100 hover:bg-gray-200">Zatvori</button>
      </div>

      <div class="p-4">
        <!-- QR reader region -->
        <div id="qr-reader" class="w-full" style="min-height:320px"></div>
      </div>
    </div>
  </div>
}

